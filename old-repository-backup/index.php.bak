<?php

require 'includes/functions.php';
require 'includes/repo-index.php';

$table_output = '';
$packages_descriptions = json_decode(file_get_contents('assets/strings/packages-descriptions.json'), 1);
foreach ($index as $category => $packages) {
    foreach ($packages as $package => $versions) {
        $version = getDirIndex('./repo/'.$category.'/'.$package);
        $version = array_pop($version);
        $description = (isset($packages_descriptions[$package])) ? $packages_descriptions[$package] : '<i>Descripción no disponible.</i>';
        $table_output .= "
            <tr>
                <td>{$package}</td>
                <td>{$description}</td>
                <td>{$version}</td>
                <td>{$category}</td>
            </tr>
        ";
    }
}

?>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Mercury - Halo CE Package Manager</title>
    <link rel="icon" type="image/png" href="assets/img/logo.png">
    <link rel="stylesheet" type="text/css" href="assets/css/material-icons.css">
    <link rel="stylesheet" type="text/css" href="assets/css/roboto-font.css">
    <link rel="stylesheet" type="text/css" href="assets/css/main.css">
</head>
<body>
    <header>
        <nav>
            <div class="nav-logo">
                <img src="assets/img/logo.png" draggable="false" alt="mercury logo">
                Mercury
            </div>
            <ul>
                <li>
                    <a href="#downloads">
                        <i class="material-icons">file_download</i>
                        <div>Descargas</div>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/Sledmine/Mercury" target="_blank">
                        <i class="material-icons">code</i>
                        <div>Github</div>
                    </a>
                </li>
            </ul>
        </nav>
    </header>
    <div class="wrapper">
        <div class="logo">
            <img src="assets/img/logo.png" draggable="false" alt="mercury logo">
            <h1>Mercury v1.1</h1>
            <p>Desarrollado por Sledmine & JerryBrick</p>
        </div>
        <div class="card">
            <div class="card-header">
                <h2>Cambios recientes:</h2>
            </div>
            <div class="card-body">
                <h4>[1.1]</h4>
                <ul>
                    <li>- Liberados binarios para Windows-x32.</li>
                    <li>- Solucionado problema al obtener rutas del juego.</li>
                </ul>
                <br>
                <h4>[1.0]</h4>
                <ul>
                    <li>- Lanzamiento inicial de Mercury-x64.</li>
                </ul>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h2>¿Qué es Mercury?</h2>
            </div>
            <div class="card-body">
                <div id="downloads" class="flag"></div>
                <p>Es un administrador de paquetes para Halo Custom Edition, un paquete puede ser tu mod "gráfico" favorito, un nuevo mapa para tu juego, etc.</p>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h2>¿Cómo lo instalo?</h2>
            </div>
            <div class="card-body">
                <p>1.- Descargar la versión de Mercury para tu sistema operativo:</p>
                <div class="download-links">
                    <a href="./downloads/release/Mercury1.1-x64.zip" class="btn" target="_blank">Mercury 1.1 Windows-x64</a>
                    <a href="./downloads/release/Mercury1.1-x32.zip" class="btn" target="_blank">Mercury 1.1 Windows-x32</a>
                </div>
                <p>2.- Descomprimir el archivo en cualquier carpeta (de preferencia "Mis Documentos").</p>
                <p>3.- Entrar a la carpeta anteriormente descomprimida llamada "Mercury1.1-x32" o "Mercury1.1-x64".</p>
                <p>4.- Abrir una linea de comando con permisos de administrador en esa carpeta.</p>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h2>¿Cómo se utiliza?</h2>
            </div>
            <div class="card-body">
                <p>Luego de abrir la linea de comando como administrador puedes usar los siguientes comandos:</p>
                <br>
                <p>
                    <b>mercury install "paquete"</b>
                    <br>Con este comando puedes instalar paquetes en tu juego.
                    <br><i>Ejemplo: mercury install hac2</i>
                </p>
                <br>
                <p>
                    <b>mercury remove "paquete"</b>
                    <br>Desintala paquetes previamente instalados.
                    <br><i>Ejemplo: mercury remove hac2</i>
                </p>
                <br>
                <p>
                    <b>mercury list "paquete"</b>
                    <br>Lista información acerca de los paquetes instalados en el juego.
                    <br><i>Ejemplo: mercury list all</i>
                </p>
                <br>
                <p>
                    <b>mercury version</b>
                    <br>Arroja en consola la versión y la licencia de Mercury.
                </p>
                <br>
                <p>
                    <b>Para obtener más información acerca de todos los comandos escribe "mercury" en la consola.</b>
                </p>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h2>¿Cómo descargo Flood 09?</h2>
            </div>
            <div class="card-body">
                <p>
                    Simplemente escribe el comando:
                    <br><b>mercury install f09</b>
                    <br><br>Texto empezará a aparecer en la consola y deberás de ver esto:
                </p>
                <br>
                <img src="assets/img/f09.png" class="rounded mx-auto d-block" alt="flood 09 successfull installation screenshot" />
                <br><br>
                <p>Si todo ha salido bien deberías de ser capáz de unirte a un servidor de la beta de Flood 09.</p>
            </div>
        </div>
        <div class="packages-table">
            <h4>Lista de Paquetes disponibles en Mercury</h4>
            <table class="table table-light">
                <thead class="thead-dark">
                    <tr>
                        <th>Paquete</th>
                        <th>Nombre completo y descripción del paquete</th>
                        <th>Versión más reciente</th>
                        <th>Categoría</th>
                    </tr>
                </thead>
                <tbody>
                    <?php print($table_output) ?>
                </tbody>
            </table>
        </div>
    </div>
    <footer>
        <h4>Mercury: Halo CE Packages Manager</h4>
        <p>Desarrollado por Sledmine & JerryBrick</p>
    </footer>
</body>
</html>